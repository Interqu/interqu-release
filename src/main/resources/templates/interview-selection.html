<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link th:href="@{/css/interview-selection.css}" rel="stylesheet" />
  <title>Interqu - Interview Selection</title>
</head>

<body>
  <div>
    <div class="form">
      <h1>Interqu Practice Interview Selection</h1>
      <div id="role">
        <label>Interview Position</label>
        <br />
        <select id="position" onchange="positionChange()">
          <option th:each="position : ${positions}" th:text="${position}" th:value="${position}"></option>
        </select>
      </div>
      <br />
      <div id="question">
        <label>Interview Question</label>
        <br />
        <select id="questions" onchange="questionChange()">
        </select>
      </div>
    </div>
    <div id="question_details">
      <label>Question: <span id="question_title"></span></label>
      <div>
        <h2>Objective:</h2>
        <table id="objective">

        </table>
      </div>
      <div>
        <h2>Avoid:</h2>
        <table id="avoid">

        </table>
      </div>
    </div>
  </div>
  <button id="tips">Tips for answering</button>
  <button class="submit">Next</button>
  <!-- The Modal -->
  <div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <p id="tipInfo"></p>
    </div>

  </div>
</body>
<script th:inline="javascript">
  var questions = /*[[${questions}]]*/ null;
  var posDoc = document.getElementById("questions");
  var displayQuestions = [];
  function getCurrentQuestionInfo() {
    var question_select = document.getElementById("questions");
    for (var i = 0; i < displayQuestions.length; i++) {
      if (displayQuestions[i].question == question_select.value) {
        return displayQuestions[i];
      }
    }
    return null;
  }
  positionChange();
  function positionChange() {
    posDoc.innerHTML = '';
    displayQuestions = [];
    questions.forEach(function (question) {
      if (question.position == document.getElementById("position").value) {
        var option = document.createElement("option");
        displayQuestions.push(question);
        option.value = question.question;
        option.innerHTML = question.question;
        posDoc.append(option)
      }
    });
    questionChange();
  }
  questionChange();
  function questionChange() {
    var question_select = document.getElementById("questions");
    var question_title = document.getElementById("question_title");
    question_title.innerHTML = question_select.value;
    var info = getCurrentQuestionInfo();
    console.log(info)
    if (info != null) {
      var objective = document.getElementById("objective");
      objective.innerHTML = '';
      for (var i = 0; i < info.positiveIndicators.length; i++) {
        var liObj = document.createElement("li");
        liObj.innerHTML = info.positiveIndicators[i];
        objective.append(liObj);
      }
      var avoid = document.getElementById("avoid");
      avoid.innerHTML = '';
      for (var i = 0; i < info.positiveIndicators.length; i++) {
        var liObj = document.createElement("li");
        liObj.innerHTML = info.negativeIndicators[i];
        avoid.append(liObj);
      }
    }
  }

  // Get the modal
  var modal = document.getElementById("myModal");

  // Get the button that opens the modal
  var btn = document.getElementById("tips");

  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];

  // When the user clicks the button, open the modal 
  btn.onclick = function () {
    modal.style.display = "block";
    // TODO change to newer method
    // Set the text
    tip = getCurrentQuestionInfo().tipsForAnswer;

    document.getElementById("tipInfo").innerHTML = tip;

  }

  // When the user clicks on <span> (x), close the modal
  span.onclick = function () {
    modal.style.display = "none";
  }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }


</script>
<script type="text/javascript" th:src="@{/js/interview-selection.js}"></script>

</html>